<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment</title>
    <style>
        /* Existing styles for the page remain the same */
        
        @import url(https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;500;600;700;800&display=swap);
      
        :root {
          --primary: #c9d8e1;
          --secondary: #5db7ee;
          --accent: #e6e1e8;
          --text: #171715;
          --bg: #e6edf0;
          --red: #913030;
          --shadow: rgba(0,0,0,0.4);
      
          /* numeric */
          --default-padding: 15px;
          --default-border-radius: 10px;
          --default-font-size: 1rem;
          --title-font-size: 1.5rem;
          --default-hover-opacity: 0.7;
          --default-transition-time: 0.15s;
          --bar-accuracy-percent: 0%;
        }
      
        * {
          color: var(--text);
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
      
        body, html {
          justify-content: center;
          align-items: center;
          font-family: 'Work Sans', sans-serif;
        }
      
        form {
          justify-content: center;
          margin:50px 0px 0px 245px;
          width: 1000px;
          padding: var(--default-padding);
          border-radius: var(--default-border-radius);
          box-shadow: 5px 5px 10px var(--shadow);
        }
      
        .question-container {
          display: none; 
          padding: var(--default-padding);
          border-radius: var(--default-border-radius);
          background-color: var(--secondary);
          box-shadow: 0 2px 5px var(--shadow);
          margin-bottom: var(--default-padding);
        }
      
        .question-label-container {
          background-color: #e6e1e8;
          margin-bottom: var(--default-padding);
          padding: var(--default-padding);
          display: flex;
          align-items: center;
          justify-content: center;
        }
      
        .option {
          background-color: aliceblue;
          border-radius: var(--default-border-radius);
          display: flex;
          align-items: center;
          gap: var(--default-padding); /* Space between radio and label */
          padding: var(--default-padding);
          cursor: pointer;
          font-size: 20px;
          transition: var(--default-transition-time);
        }
      
        .option:hover {
          background-color: rgb(16, 180, 245); /* Subtle hover effect */
        }
      
        input[type="radio"] {
          height: 24px;
          width: 24px;
          margin-right: 10px;
          cursor: pointer;
        }
      
        .submit-button-container {
          display: flex;
          justify-content: center;
          align-items: center;
        }
      
        #submitButton {
          background-color: #09973b; 
          border: none;
          color: rgb(255, 255, 255);
          padding: 15px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
        }
      
        #submitButton:hover {
          background-color: rgb(3, 78, 29);
          color: rgb(245, 251, 247); 
        }
      
        .submit-button-disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }
      
        #prevButton {
          background-color: #0f1010; 
          border: none;
          color: white;
          padding: 15px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
        }
      
        #nextButton {
          background-color: #199ff8; 
          border: none;
          color: white;
          padding: 15px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
        }
      
        .questionSetNameContainer {
          margin-bottom: var(--default-padding);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: var(--title-font-size);
        }
      
        input {
          width: 100%;
          padding: 20px;
          margin-left: 20px;
          margin-right: 30px;
          border: 1px solid #ccc;
          border-radius: 5px;
        }
      
        input[type='text'] {
          font-size: 20px;
        }
      
        /* Media Queries for Responsiveness */
      
        @media (max-width: 1024px) {
          form {
            width: 90%;  /* Adjust form width to fit smaller screens */
            margin-left: auto;
            margin-right: auto;
          }
      
          #submitButton, #prevButton, #nextButton {
            padding: 12px 20px;  /* Smaller buttons on medium screens */
            font-size: 14px;
          }
      
          .question-label-container {
            padding: 10px;
          }
        }
      
        @media (max-width: 768px) {
          form {
            width: 95%;
            margin: 20px;  /* Reduce margin for smaller screens */
          }
      
          .submit-button-container {
            flex-direction: column;  /* Stack buttons vertically on smaller screens */
          }
      
          #submitButton, #prevButton, #nextButton {
            width: 100%;  /* Make buttons full-width on mobile */
            margin-bottom: 10px;
          }
      
          .question-label-container {
            padding: 8px;
          }
      
          .option {
            font-size: 18px;  /* Smaller font size for options */
            padding: 12px;
          }
      
          .question-container {
            padding: 10px;  /* Reduce padding inside questions */
          }
      
          input {
            padding: 10px;  /* Smaller input fields */
          }
        }
      
        @media (max-width: 480px) {
          form {
            width: 100%;
            padding: 10px;
          }
      
          .submit-button-container {
            flex-direction: column;
          }
      
          #submitButton, #prevButton, #nextButton {
            width: 100%;
            padding: 10px;
          }
      
          .question-label-container {
            padding: 5px;
          }
      
          .option {
            font-size: 16px;
            padding: 10px;
          }
      
          input {
            padding: 8px;
          }
        }
      </style>



<script>
    let totalQuestions = {{ questions|length }}; 

    
    function updateScore() {
        let score = 0;

        for (let i = 0; i < totalQuestions; i++) {
            const selectedOption = document.querySelector(`input[name="options-${i}"]:checked`);
            const correctAnswer = document.querySelector(`input[name="answer"][data-index="${i}"]`).value;

            if (selectedOption && selectedOption.value === correctAnswer) {
                score++;
            }
        }

        document.querySelector('.score-input').value = score; 
    }

    
    function validateAnswers() {
        for (let i = 0; i < totalQuestions; i++) {
            const selectedOption = document.querySelector(`input[name="options-${i}"]:checked`);
            if (!selectedOption) {
                alert(`Please answer question ${i + 1}.`);
                return false;
            }
        }
        return true; 
    }

    
    function handleSubmit(event) {
        if (!validateAnswers()) {
            event.preventDefault(); 
        } else {
            updateScore();
        }
    }

    
    function addEventListeners() {
        const form = document.querySelector('form');
        form.addEventListener('submit', handleSubmit);

        for (let i = 0; i < totalQuestions; i++) {
            const options = document.querySelectorAll(`input[name="options-${i}"]`);
            options.forEach(option => {
                option.addEventListener('change', updateScore);
            });
        }
    }

    window.onload = addEventListeners;
</script>
</head>
<body>
   
           
 



<form method="POST" action="">
    <div class="questionSetNameContainer panel">
        <h1 id="questionSetLabel" class="title-text"> Assessmenttttt </h1>

    </div>
    {% csrf_token %}
    
    <!-- <h2>Assessment for {{ exam.created_for }} Exam</h2> -->
    <h3>Allowed Time&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ formatted_allowed_time}}</h3><br>
    <h3>Exam Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ set_date }}</h3><br>
        <h3>Exam Time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ set_time }}</h3><br>
        <h3>Ending Time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{end_datetime}} </h3><br><br>
       
    {% for question in questions %}
    <div class="question-container">
        <div class="question-label-container">
            <h2 id="questionLabel">{{ forloop.counter }}.{{question.question}}</h2>
            <input type="hidden" name="qid" value="{{question.id}}">
        </div>

        <div id="optionList">
            <div class="option">
                <input type="radio" id="option1-{{ forloop.counter0 }}" name="options-{{ forloop.counter0 }}" value="option1">
                <label for="option1-{{ forloop.counter0 }}">{{question.option1}}</label>
            </div><br>
            <div class="option">
                <input type="radio" id="option2-{{ forloop.counter0 }}" name="options-{{ forloop.counter0 }}" value="option2">
                <label for="option2-{{ forloop.counter0 }}">{{question.option2}}</label>
            </div><br>
            <div class="option">
                <input type="radio" id="option3-{{ forloop.counter0 }}" name="options-{{ forloop.counter0 }}" value="option3">
                <label for="option3-{{ forloop.counter0 }}">{{question.option3}}</label>
            </div><br>
        </div>
        <input type="hidden" name="answer" data-index="{{ forloop.counter0 }}" value="{{ question.answer }}">
    </div>

    {% endfor %}

    <div>
        <input type="hidden" name="score" class="score-input" value="0" readonly>
    </div>

    <div class="submit-button-container">
        <button type="button" id="prevButton" disabled>Previous</button>
        <button type="button" id="nextButton">Next</button>
        <button type="submit" id="submitButton" style="display: none;">Submit</button>
    </div>
</form>


<h2 style="text-align: center;">Here Your Countdown</h2>

<p style="display: none;">Allowed Time: {{ formatted_allowed_time }}</p>
<p style="display: none;">Exam Date: {{ set_date|date:"Y-m-d" }}</p>  <!-- Pass the date as YYYY-MM-DD -->
<p style="display: none;">Exam Time: {{ set_time|date:"H:i:s" }}</p>  <!-- Pass the time as HH:MM:SS -->
<p style="display: none;">Ending Time: {{ end_datetime|date:"Y-m-d H:i:s" }}</p>  

<p style="text-align: center;">Time Remaining: <span id="timer"></span></p>

<script type="text/javascript">
    // Get the exam start date, time, and end time from Django template
    let setDateString = "{{ set_date|date:'Y-m-d' }}";  // Example: '2025-01-07'
    let setTimeString = "{{ set_time|date:'H:i:s' }}";  // Example: '10:00:00'
    let endDateTimeString = "{{ end_datetime|date:'Y-m-d H:i:s' }}";  // Example: '2025-01-07 10:10:00'

    // Combine set_date and set_time into a valid ISO date string for JavaScript
    let examDateTime = new Date(setDateString + 'T' + setTimeString);  // ISO format: '2025-01-07T10:00:00'
    let endDateTime = new Date(endDateTimeString);  // This is already in a valid format: '2025-01-07T10:10:00'

    // Function to update the countdown
    function updateTimer() {
        let now = new Date().getTime();
        let timeLeft = endDateTime - now;

        if (timeLeft <= 0) {
            // If the time is up, stop the timer, show alert and redirect
            clearInterval(timerInterval);
            document.getElementById("timer").innerHTML = "Time's up!";
            
            // Show an alert
            alert("The exam time is over! Better luck next time.");
            
            // Redirect to home page after the user clicks "OK"
            window.location.href = "/home";
        } else {
            // Calculate hours, minutes, and seconds remaining
            let hours = Math.floor((timeLeft / (1000 * 60 * 60)) % 24);
            let minutes = Math.floor((timeLeft / (1000 * 60)) % 60);
            let seconds = Math.floor((timeLeft / 1000) % 60);

            // Display the time remaining in HH:MM:SS format
            document.getElementById("timer").innerHTML = `${hours}h ${minutes}m ${seconds}s`;
        }
    }

    // Update the timer every second
    let timerInterval = setInterval(updateTimer, 1000);

    // Run the updateTimer function immediately on page load
    updateTimer();
</script>



<script>
    const questions = document.querySelectorAll('.question-container');
    let currentQuestion = 0;

    
    questions[currentQuestion].style.display = 'block';

    document.getElementById('nextButton').addEventListener('click', function() {
        if (currentQuestion < questions.length - 1) {
            questions[currentQuestion].style.display = 'none';
            currentQuestion++;
            questions[currentQuestion].style.display = 'block';
            updateButtons();
        }
    });

    document.getElementById('prevButton').addEventListener('click', function() {
        if (currentQuestion > 0) {
            questions[currentQuestion].style.display = 'none';
            currentQuestion--;
            questions[currentQuestion].style.display = 'block';
            updateButtons();
        }
    });

    function updateButtons() {
        document.getElementById('prevButton').disabled = currentQuestion === 0;
        document.getElementById('nextButton').style.display = currentQuestion < questions.length - 1 ? 'block' : 'none';
        document.getElementById('submitButton').style.display = currentQuestion === questions.length - 1 ? 'block' : 'none';
    }
</script>

</body>
</html>